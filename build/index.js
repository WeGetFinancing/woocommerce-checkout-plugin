(()=>{"use strict";const e=window.wp.htmlEntities,t=window.wp.element,n=window.ReactJSXRuntime;console.log("WEGETFINANCING STARTED!!!");let i=!1,o=document.createElement("style");o.innerHTML=".wgf_checkout_button:hover {opacity: 0.85;}",o.innerHTML+=".wgf_checkout_button_disabled { opacity: 0.5; cursor: wait; }",o.innerHTML+=".wgf_checkout_button_img { width: 100%; max-width: 320px; }",document.head.appendChild(o);let s=null,l=null;const{registerPaymentMethod:c}=window.wc.wcBlocksRegistry,{getSetting:a}=window.wc.wcSettings,d=a("wegetfinancing_data",{}),r=d.description,p=n=>{const i=n.billing,o=n.shippingData;s=i,l=o;const{eventRegistration:c,emitResponse:a}=n,{onPaymentSetup:p}=c;return(0,t.useEffect)(()=>{const e=p(async()=>{let e=document.getElementById(d.order_inv_id_field_id),t=document.getElementById("order_wgf_href");const n=e?e.value:null,i=t?t.value:null;return n.length&&i.length?{type:a.responseTypes.SUCCESS,meta:{paymentMethodData:{inv_id:n,wgf_href:i}}}:{type:a.responseTypes.ERROR,message:"There was an error"}});return()=>{e()}},[a.responseTypes.ERROR,a.responseTypes.SUCCESS,p]),(0,e.decodeEntities)(r)},g=()=>(0,n.jsx)("img",{src:d.checkout_logo_image_url,style:{float:"left"},alt:d.checkout_button_alt}),_=()=>(0,n.jsx)(g,{});c({name:"wegetfinancing",label:(0,n.jsx)(_,{}),content:(0,n.jsx)(p,{}),edit:(0,n.jsx)(p,{}),canMakePayment:()=>!0,ariaLabel:"WeGetFinancing"});const u=document.createElement("a");u.id="wgf_checkout_button",u.className="wgf_checkout_button",u.href="#wgf_checkout",u.style.display="none",u.style.width="250px",u.onclick=()=>{console.log("WGF ON CLICK ACTION");const e=document.querySelector("#wgf_checkout_button");e.classList.add("wgf_checkout_button_disabled"),e.style.pointerEvents="none",e.setAttribute("aria-disabled","true"),w()};const m=document.createElement("img");m.src=d.checkout_button_image_url,m.alt=d.checkout_button_alt,m.style.maxWidth="320px",m.className="wgf_checkout_button_img",u.append(m),document.addEventListener("input",e=>{setTimeout(()=>{console.log("WGF addEventListener ACTION");const t=document.querySelector(".wc-block-components-checkout-place-order-button"),n=document.querySelector("#wgf_checkout_button");if(n||(t.closest("div").append(u),document.querySelector("#wgf_checkout_button")),"radio-control-wc-payment-method-options"===e.target.getAttribute("name"))console.log("WGF IS radio-control-wc-payment-method-options ACTION"),e.target.value===d.payment_method_id?(console.log("WGF ACTIVE ACTION"),"none"!==t.style.display&&(t.style.display="none",console.log("WGF is active and placeOrderBtn IS DIFFERENT THAN none, SET DISPLAY TO none ACTION")),"block"!==n.style.display&&(n.style.display="block",console.log("WGF is active and wgfBtnElement IS DIFFERENT THAN block, SET DISPLAY TO block ACTION"))):"none"!==n.style.display&&(n.style.display="none",console.log("WGF is NOT active and wgfBtnElement IS DIFFERENT THAN none, SET DISPLAY TO block ACTION"));else if(!document.querySelector('input[name="radio-control-wc-payment-method-options"]')){const e=!0;t.style.display=e?"none":"block",n.style.display=e?"block":"none"}i||(i=!0)},1e3)}),window.onload=e=>{h()};const h=function(){const e=document.querySelector(".wc-block-components-checkout-place-order-button");if(!e)return void setTimeout(h,50);e.closest("div").append(u);const t=document.querySelector("#wgf_checkout_button"),n=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked');n?b(n,e,t):setTimeout(h,50)},b=function(e,t,n){e&&"value"in e&&e.value===d.payment_method_id&&(t.style.display="none",n.style.display="block")},y={billing_first_name:"billing-first_name",billing_last_name:"billing-last_name",billing_country:"billing-country",billing_address_1:"billing-address_1",billing_address_2:"billing-address_2",billing_city:"billing-city",billing_state:"billing-state",billing_postcode:"billing-postcode",billing_phone:"billing-phone",billing_email:"email",shipping_first_name:"shipping-first_name",shipping_last_name:"shipping-last_name",shipping_country:"shipping-country",shipping_address_1:"shipping-address_1",shipping_address_2:"shipping-address_2",shipping_city:"shipping-city",shipping_state:"shipping-state",shipping_postcode:"shipping-postcode",shipping_phone:"shipping-phone"},w=()=>{let e={};e[d.billing_first_name]=s.billingData.first_name,e[d.billing_last_name]=s.billingData.last_name,e[d.billing_country]=s.billingData.country,e[d.billing_address_1]=s.billingData.address_1,e[d.billing_address_2]=s.billingData.address_2,e[d.billing_city]=s.billingData.city,e[d.billing_state]=s.billingData.state,e[d.billing_postcode]=s.billingData.postcode,e[d.billing_phone]=s.billingData.phone,e[d.billing_email]=s.billingData.email,e[d.shipping_first_name]=l.shippingAddress.first_name,e[d.shipping_last_name]=l.shippingAddress.last_name,e[d.shipping_country]=l.shippingAddress.country,e[d.shipping_address_1]=l.shippingAddress.address_1,e[d.shipping_address_2]=l.shippingAddress.address_2,e[d.shipping_city]=l.shippingAddress.city,e[d.shipping_state]=l.shippingAddress.state,e[d.shipping_postcode]=l.shippingAddress.postcode,e[d.shipping_phone]=l.shippingAddress.phone;let t=new FormData;t.append("action",d.ajax_action),t.append("_wpnonce",d.nonce);for(let n in e)t.append(`data[${n}]`,e[n]);fetch(d.ajax_url,{method:"POST",body:t}).then(e=>e.json()).then(e=>{const t=document.querySelector("#wgf_checkout_button");t.classList.remove("wgf_checkout_button_disabled"),t.style.pointerEvents="auto",t.removeAttribute("aria-disabled");let n=document.getElementById("wgf-errors-block-content");n&&(n.innerHTML=""),"isSuccess"in e&&(!1===e.isSuccess?f(e):E(e))}).catch(e=>console.log(e))},f=e=>{if("violations"in e){const n=e.violations;for(let e in n){let i=n[e];if("fields"in i&&"messages"in i)for(let e in i.fields){var t;let n=i.fields[e],o=i.messages[e],s=null!==(t=y[n])&&void 0!==t?t:e,l=document.getElementById(s);l?k(l,o):T(o)}}}},k=(e,t)=>{let n=e.closest("div"),i=n.querySelector(".wc-block-components-validation-error");if(!i){let e=v();n.append(e),i=n.querySelector(".wc-block-components-validation-error")}i.innerHTML=`<p>${t}</p>`,n.classList.add("has-error")},v=()=>{let e=document.createElement("div");return e.className="wc-block-components-validation-error",e},E=e=>{const t=document.querySelector(".wc-block-components-checkout-place-order-button"),n=t.closest("form");let i=document.getElementById(d.order_inv_id_field_id);i||(i=document.createElement("input"),i.id=d.order_inv_id_field_id,i.name=d.order_inv_id_field_id,i.type="hidden",n.append(i)),i.value=e.invId;let o=document.getElementById("order_wgf_href");o||(o=document.createElement("input"),o.id="order_wgf_href",o.name="order_wgf_href",o.type="hidden",n.append(o)),o.value=e.href,t.click()},T=e=>{if(!document.getElementById("wgf-errors-block-content")){let e=document.createElement("div");e.className="woocommerce-notices-wrapper";let t=document.createElement("div");t.className="wc-block-components-notice-banner is-error",t.role="alert",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">\n        <path d="M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"></path>\n    </svg>';let n=document.createElement("div");n.className="wc-block-components-notice-banner__content",n.id="wgf-errors-block-content",t.append(n),e.append(t),document.querySelector(".wc-block-components-checkout-place-order-button").closest("form").prepend(e)}document.getElementById("wgf-errors-block-content").innerHTML+=`<li>${e}</li>`}})();