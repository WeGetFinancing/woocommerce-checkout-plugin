<style>
    .row {
        padding-top: 2em;
    }
</style>
<div class="container">
    <div class="row">
        <div class="card">
            <div class="card-body">
                <h1>WeGetFinancing PPE Configuration Page</h1>
                <div class="row">
                    <h5>Your Shortcode is:<code>[wegetfinancing-ppe]</code></h5>
                </div>
            </div>
        </div>
    </div>
    <div id="ppe_settings_messages_area"></div>
    <div class="row">
        <div class="card">
            <div class="card-body">
                <form>
                    <div class="mb-3">
                        <label for="{{ ppePriceSelectorId }}" class="form-label">{{ ppePriceSelectorName }}</label>
                        <input
                                id="{{ ppePriceSelectorId }}"
                                value="{{ ppePriceSelectorValue }}"
                                type="text"
                                class="form-control"
                                aria-describedby="{{ ppePriceSelectorId }}_help"
                        />
                        <div id="{{ ppePriceSelectorId }}_help" class="form-text">Class to find the prices on the page</div>
                    </div>
                    <div class="mb-3">
                        <label for="{{ ppeProductNameSelectorId }}" class="form-label">{{ ppeProductNameSelectorName }}</label>
                        <input
                                id="{{ ppeProductNameSelectorId }}"
                                value="{{ ppeProductNameSelectorValue }}"
                                type="text"
                                class="form-control"
                                aria-describedby="{{ ppeProductNameSelectorId }}_help"
                        />
                        <div id="{{ ppeProductNameSelectorId }}_help" class="form-text">If applyNow is set to true, this selector is</div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="{{ ppeIsDebugId }}" {% if ppeIsDebugValue %}checked{% endif %}>
                        <label class="form-check-label" for="{{ ppeIsDebugId }}">{{ ppeIsDebugName }}</label>
                    </div>
                    <div class="mb-3">
                        <label for="{{ ppeTokenId }}" class="form-label">{{ ppeTokenName }}</label>
                        <input
                                id="{{ ppeTokenId }}"
                                value="{{ ppeTokenValue }}"
                                type="text"
                                class="form-control"
                                aria-describedby="{{ ppeTokenId }}_help"
                        />
                        <div id="{{ ppeTokenId }}_help" class="form-text">Merchants need to add their WeGetFinancing's access token</div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="{{ ppeIsApplyNowId }}" {% if ppeIsApplyNowValue %}checked{% endif %}>
                        <label class="form-check-label" for="{{ ppeIsApplyNowId }}">{{ ppeIsApplyNowName }}</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="{{ ppeIsBrandedId }}" {% if ppeIsBrandedValue %}checked{% endif %}>
                        <label class="form-check-label" for="{{ ppeIsBrandedId }}">{{ ppeIsBrandedName }}</label>
                    </div>
                    <div class="mb-3">
                        <label for="{{ ppeMinAmountId }}" class="form-label">{{ ppeMinAmountName }}</label>
                        <input
                                id="{{ ppeMinAmountId }}"
                                value="{{ ppeMinAmountValue }}"
                                type="text"
                                class="form-control"
                                aria-describedby="{{ ppeMinAmountId }}_help"
                        />
                        <div id="{{ ppeMinAmountId }}_help" class="form-text">We will not show the PPE if the amount is below this number</div>
                    </div>
                    <div class="mb-3">
                        <label for="{{ ppeCustomTextId }}" class="form-label">{{ ppeCustomTextName }}</label>
                        <input
                                id="{{ ppeCustomTextId }}"
                                value="{{ ppeCustomTextValue }}"
                                type="text"
                                class="form-control"
                                aria-describedby="{{ ppeCustomTextId }}_help"
                        />
                        <div id="{{ ppeCustomTextId }}_help" class="form-text">Add any text before the monthly payment in the message under the price</div>
                    </div>
                    <div class="mb-3">
                        <label for="{{ ppePositionId }}" class="form-label">{{ ppePositionName }}</label>
                        <input
                                id="{{ ppePositionId }}"
                                value="{{ ppePositionValue }}"
                                type="text"
                                class="form-control"
                                aria-describedby="{{ ppePositionId }}_help"
                        />
                        <div id="{{ ppePositionId }}_help" class="form-text">Positions the widget horizontally. The options are equalSpacing' | 'leading' | 'trailing' | 'center' | 'fill' | 'fillEvenly'</div>
                    </div>
                    <a id="{{ ppeSaveButtonId }}" class="btn btn-primary">Save</a>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    function wgf_ppe_save_settings(settings) {
        let request = {
            'action': '{{ ajaxAction }}',
            'data': settings
        }

        jQuery.ajax({
            type: "post",
            dataType: "json",
            url: "{{ ajaxUrl }}",
            data: request,
            success: function(response){
                let message = jQuery("#ppe_settings_messages_area");
                message.html('');
                if (response.isSuccess == false) {
                    jQuery.each( response.violations, function( i, violation ) {
                        jQuery('#'+violation.field).addClass('is-invalid');
                        message.append('<div class="notice notice-error is-dismissible">'+
                            '</p>'+violation.message+'</p>'+
                            '</div>');
                    });
                } else {
                    message.html('<div class="notice notice-success is-dismissible">'+
                        '<p>Data successfully saved.</p>'+
                        '</div>');
                }
            },
            error: function(){
                let message = jQuery("#ppe_settings_messages_area");
                message.html('');
                message.html('<<div class="notice notice-error is-dismissible">'+
                    '<p>Unexpected server error, please contact our tech support.</p>'+
                    '</div>');
            },
        });
    }

    function wgf_ppe_clean_input_data() {
        {{ ppePriceSelectorId }}: jQuery('#{{ ppePriceSelectorId }}').removeClass('is-invalid');
        {{ ppeProductNameSelectorId }}: jQuery('#{{ ppeProductNameSelectorId }}').removeClass('is-invalid');
        {{ ppeTokenId }}: jQuery('#{{ ppeTokenId }}').removeClass('is-invalid');
        {{ ppeMinAmountId }}: jQuery('#{{ ppeMinAmountId }}').removeClass('is-invalid');
        {{ ppeCustomTextId }}: jQuery('#{{ ppeCustomTextId }}').removeClass('is-invalid');
        {{ ppePositionId }}: jQuery('#{{ ppePositionId }}').removeClass('is-invalid');
    }

    jQuery('#{{ ppeSaveButtonId }}').click((e) => {
        wgf_ppe_clean_input_data();

        let isDebug = jQuery('#{{ ppeIsDebugId }}').is(':checked')
                ? "true" : "false",
            isApplyNow = jQuery('#{{ ppeIsApplyNowId }}').is(':checked')
                ? "true" : "false",
            isBranded = jQuery('#{{ ppeIsBrandedId }}').is(':checked')
                ? "true" : "false";

        let settings = {
            {{ ppePriceSelectorId }}: jQuery('#{{ ppePriceSelectorId }}').val(),
            {{ ppeProductNameSelectorId }}: jQuery('#{{ ppeProductNameSelectorId }}').val(),
            {{ ppeIsDebugId }}: isDebug,
            {{ ppeIsApplyNowId }}: isApplyNow,
            {{ ppeIsBrandedId }}: isBranded,
            {{ ppeTokenId }}: jQuery('#{{ ppeTokenId }}').val(),
            {{ ppeMinAmountId }}: jQuery('#{{ ppeMinAmountId }}').val(),
            {{ ppeCustomTextId }}: jQuery('#{{ ppeCustomTextId }}').val(),
            {{ ppePositionId }}: jQuery('#{{ ppePositionId }}').val()
        };

        wgf_ppe_save_settings(settings);
    });
</script>
